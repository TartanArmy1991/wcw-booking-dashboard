<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WCW 2000 Tracker • Show</title>
  <link rel="stylesheet" href="/css/styles.css"/>
</head>
<body>
  
<header class="site">
  <div class="navwrap">
    <div class="logo">
      <span class="wcw">WCW</span> <span>2000 Tracker</span><br/>
      <small>TEW 9 • Your booking, show view</small>
    </div>
    <nav>
      <a href="/index.html">Dashboard</a>
      <a href="/roster.html">Roster</a>
      <a href="/champions.html">Champions</a>
      <a href="/teams.html">Tag Teams</a>
      <a href="/factions.html">Factions</a>
      <a href="/developmental.html">Developmental</a>
      <a href="/schedule.html">Schedule</a>
    </nav>
    <div class="right">
      <button id="btnPrev" class="badge">←</button>
      <label for="datePicker" class="badge">Week</label>
      <input id="datePicker" type="date" min="2000-01-01" max="2000-12-31"/>
      <button id="btnNext" class="badge">→</button>
    </div>
  </div>
</header>

  <main>
    <section class="card">
      <h1 id="hShow">Show</h1>
      <div class="grid cols-3">
        <div class="kpi"><div class="label">Date</div><div id="kDate" class="value">—</div></div>
        <div class="kpi"><div class="label">Type</div><div id="kType" class="value">—</div></div>
        <div class="kpi"><div class="label">Length</div><div id="kLen" class="value">—</div></div>
      </div>
      <div class="badge" id="kNotes" style="display:block; margin-top:10px">—</div>
    </section>

    
<section class="card" style="margin-top:16px">
  <h2>Card (Opening → Main Event)</h2>
  <table id="tblCard"><thead><tr><th>#</th><th>Type</th><th>Title</th><th>People</th><th>Result / Notes</th></tr></thead><tbody></tbody></table>
</section>

  </main>
  <footer class="footer">WCW 2000 • Show page</footer>
  
<script src="/js/app.js"></script>
<script>
(async function(){
  const url = new URL(location.href);
  const date = url.searchParams.get("date");
  const show = url.searchParams.get("show");
  if (!date || !show){ document.getElementById("hShow").textContent = "Missing show params"; return; }

  const sched = await fetchJSON("/api/schedule");
  const all = [...sched.nitro, ...sched.thunder, ...sched.saturday_night, ...sched.ppv];
  const meta = all.find(s => s.date === date && s.show === show) || {minutes: null, brand: null};

  function brandLabel(b){
    if (!b) return "—";
    const u = String(b).toUpperCase();
    if (u.startsWith("A")) return "A Show";
    if (u.startsWith("B")) return "B Show";
    return "PPV";
  }

  document.getElementById("hShow").textContent = show;
  document.getElementById("kDate").textContent = date;
  document.getElementById("kType").textContent = brandLabel(meta.brand);
  document.getElementById("kLen").textContent = meta.minutes ? meta.minutes + " mins" : "—";

  const data = await fetchJSON(`/api/show?date=${encodeURIComponent(date)}&show=${encodeURIComponent(show)}`);
  document.getElementById("kNotes").textContent = data.notes || "—";

  // Build merged card
  let card = Array.isArray(data.card) ? data.card.slice() : [];
  // Back-compat: if matches/segments exist, fold them in with inferred order
  if ((!card.length) && (Array.isArray(data.matches) || Array.isArray(data.segments))){
    const m = (data.matches||[]).map((x,i)=>({type:"Match", order:x.order ?? i*2+1, title:x.title, people:x.participants, result:x.result, notes:x.notes}));
    const s = (data.segments||[]).map((x,i)=>({type:"Segment", order:x.order ?? i*2, title:x.title, people:x.people, result:"", notes:x.notes}));
    card = [...m,...s];
  }
  card.sort((a,b)=> (a.order??0) - (b.order??0));
  const tb = document.querySelector("#tblCard tbody");
  tb.innerHTML = card.map((c,idx)=>{
    const people = (c.people||[]).join(", ");
    const rn = [c.result, c.notes].filter(Boolean).join(" — ");
    return `<tr><td>${idx+1}</td><td>${c.type||""}</td><td>${c.title||""}</td><td>${people}</td><td>${rn}</td></tr>`;
  }).join("") || `<tr><td colspan="5">No card saved for this show.</td></tr>`;
})();
</script>

</body>
</html>
