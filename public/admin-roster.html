<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WCW 2000 Tracker • Roster Bulk Edit</title>
  <link rel="stylesheet" href="/css/styles.css"/>
</head>
<body>
  <header class="site">
    <div class="navwrap">
      <div class="logo">
        <span class="wcw">WCW</span> <span>2000 Tracker</span><br/>
        <small>TEW 9 • Roster bulk edit</small>
      </div>
      <nav>
        <a href="/roster.html">Roster</a>
      </nav>
      <div class="right"><button id="btnPrev" class="badge">←</button><label for="datePicker" class="badge">Week</label><input id="datePicker" type="date" min="2000-01-01" max="2000-12-31"/><button id="btnNext" class="badge">→</button></div>
    </div>
  </header>

  <main>
    <section class="card">
      <h1>Bulk Edit: Disposition &amp; Push</h1>
      <p>Paste lines like: <code>Name,Disposition,Push,status(optional)</code></p>
      <pre class="badge">Examples:
Bret Hart,Heel,Main Event,active
Billy Kidman,Face,Upper Midcard,active</pre>
      <textarea id="ta" style="width:100%;height:240px;background:#0f0f19;color:#e9e9f2;border:1px solid rgba(255,255,255,.12);border-radius:8px;"></textarea>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center;">
        <button id="btnApply" style="padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:#16162a;color:#fff">Apply to Week</button>
        <span id="msg" class="badge">—</span>
      </div>
    </section>
  </main>
  <footer class="footer">WCW 2000 • Bulk Edit</footer>
  <script src="/js/app.js"></script>
  <script>
  (function(){
    const msg = document.getElementById("msg");
    async function run(){
      const { weekKey } = await loadWeekSnapshot();
      const lines = document.getElementById("ta").value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      const updates = [];
      for (const line of lines){
        const parts = line.split(",").map(s=>s.trim());
        if (!parts[0]) continue;
        updates.push({ name: parts[0], disposition: parts[1]||"", push: parts[2]||"", status: parts[3]||undefined });
      }
      const res = await fetch(`/api/week/${encodeURIComponent(weekKey)}/roster`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ updates })
      });
      const js = await res.json();
      msg.textContent = js.ok ? `Updated ${js.count} records for ${weekKey}.` : (js.error||"Error");
    }
    document.getElementById("btnApply").addEventListener("click", run);
  })();
  </script>
</body>
</html>
